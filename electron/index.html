<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minecraft LLM Bot - Control Panel</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Minecraft LLM Bot</h1>
        <p class="subtitle">Панель настройки (ранняя версия, возможны ошибки)</p>
      </div>
      <div class="actions">
        <button id="saveAllBtn" class="primary">Сохранить все</button>
      </div>
    </header>

    <nav class="tabs">
      <button class="tab-button active" data-tab-target="main">Основное</button>
      <button class="tab-button" data-tab-target="training">Обучение</button>
    </nav>

    <section class="card">
      <h2>Статус</h2>
      <div class="status-grid">
        <div>
          <div class="label">ViaProxy (локальное подключение)</div>
          <div id="proxyStatus" class="status">не проверено</div>
          <button id="checkProxyBtn" class="ghost">Проверить</button>
        </div>
        <div>
          <div class="label">Ollama (модели)</div>
          <div id="ollamaStatus" class="status">не проверено</div>
          <button id="refreshModelsBtn" class="ghost">Обновить список</button>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Запуск</h2>
      <div class="status-grid">
        <div>
          <div class="label">ViaProxy процесс</div>
          <div id="viaProxyRunStatus" class="status">остановлен</div>
          <div class="actions">
            <button id="startViaProxyBtn" class="primary">Запустить ViaProxy</button>
            <button id="stopViaProxyBtn" class="ghost">Остановить</button>
          </div>
        </div>
        <div>
          <div class="label">Бот процесс</div>
          <div id="botRunStatus" class="status">остановлен</div>
          <div class="actions">
            <button id="startBotBtn" class="primary">Запустить бота</button>
            <button id="stopBotBtn" class="ghost">Остановить</button>
          </div>
        </div>
      </div>
      <div class="grid">
        <label>Автостарт бота
          <select id="autoStartBot">
            <option value="true">да</option>
            <option value="false">нет</option>
          </select>
        </label>
      </div>
      <div class="actions">
        <button id="startAllBtn" class="primary">Запустить всё</button>
      </div>
    </section>

    <section class="card">
      <h2>Логи</h2>
      <div class="actions">
        <button id="openLogsBtn" class="ghost">Открыть папку логов</button>
      </div>
      <div class="log-grid">
        <div>
          <div class="label">Бот</div>
          <textarea id="botLog" class="log-output" rows="10" readonly></textarea>
        </div>
        <div>
          <div class="label">ViaProxy</div>
          <textarea id="proxyLog" class="log-output" rows="10" readonly></textarea>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Подключение бота</h2>
      <div class="grid">
        <label>BOT_HOST<input id="botHost" type="text" /></label>
        <label>BOT_PORT<input id="botPort" type="number" /></label>
        <label>BOT_USERNAME<input id="botUsername" type="text" /></label>
        <label>BOT_VERSION<input id="botVersion" type="text" /></label>
        <label>BOT_AUTH<input id="botAuth" type="text" /></label>
      </div>
    </section>

    <section class="card">
      <h2>ViaProxy / сервер</h2>
      <div class="grid">
        <label>MC_SERVER_HOST<input id="serverHost" type="text" /></label>
        <label>MC_SERVER_PORT<input id="serverPort" type="number" /></label>
      </div>
      <p class="hint">Для работы бот подключается к локальному прокси (BOT_HOST/BOT_PORT). Серверные данные синхронизируются в viaproxy.yml.</p>
    </section>

    <section class="card">
      <h2>ViaProxy настройки</h2>
      <div class="grid">
        <label>target-version<input id="viaProxyTargetVersion" type="text" /></label>
        <label>auth-method
          <select id="viaProxyAuthMethod">
            <option value="NONE">NONE (offline)</option>
            <option value="ACCOUNT">ACCOUNT (online)</option>
          </select>
        </label>
        <label>proxy-online-mode
          <select id="viaProxyOnlineMode">
            <option value="false">false</option>
            <option value="true">true</option>
          </select>
        </label>
        <label>minecraft-account-index<input id="viaProxyAccountIndex" type="number" min="0" /></label>
        <label>backend-proxy-url<input id="viaProxyBackendProxyUrl" type="text" /></label>
      </div>
      <p class="hint">Оффлайн сервер = auth-method NONE. Онлайн сервер = ACCOUNT + аккаунт в ViaProxy GUI.</p>
    </section>

    <section class="card">
      <h2>ViaProxy запуск</h2>
      <div class="grid">
        <label>Папка ViaProxy<input id="viaProxyRoot" type="text" /></label>
        <label>JAR ViaProxy<input id="viaProxyJar" type="text" /></label>
        <label>Java путь (опционально)<input id="javaPath" type="text" /></label>
        <label>Аргументы (через пробел)<input id="viaProxyArgs" type="text" /></label>
        <label>Автостарт ViaProxy
          <select id="autoStartProxy">
            <option value="true">да</option>
            <option value="false">нет</option>
          </select>
        </label>
        <label>Синхронизировать viaproxy.yml
          <select id="syncViaProxyConfig">
            <option value="true">да</option>
            <option value="false">нет</option>
          </select>
        </label>
      </div>
      <p class="hint">ViaProxy запускается через Java: `java -jar ViaProxy-*.jar`.</p>
    </section>

    <section class="card">
      <h2>Подключение</h2>
      <div class="grid">
        <label>Автоподключение
          <select id="autoReconnect">
            <option value="true">да</option>
            <option value="false">нет</option>
          </select>
        </label>
        <label>Задержка переподключения (мс)<input id="reconnectDelayMs" type="number" /></label>
        <label>Лимит попыток (0 = бесконечно)<input id="maxReconnectAttempts" type="number" /></label>
        <label>Ожидать прокси при запуске
          <select id="waitForProxy">
            <option value="true">да</option>
            <option value="false">нет</option>
          </select>
        </label>
        <label>Таймаут ожидания (мс)<input id="waitForProxyTimeoutMs" type="number" /></label>
      </div>
      <p class="hint">Если соединение сбросилось (ECONNRESET), бот автоматически переподключится.</p>
    </section>

    <section class="card">
      <h2>Ollama / LLM</h2>
      <div class="grid">
        <label>OLLAMA_HOST<input id="ollamaHost" type="text" /></label>
        <label>OLLAMA_MODEL<input id="ollamaModel" type="text" /></label>
        <label>OLLAMA_CONTEXT<input id="ollamaContext" type="number" /></label>
        <label>OLLAMA_TEMPERATURE<input id="ollamaTemperature" type="number" step="0.1" /></label>
      </div>
      <div class="models">
        <div class="label">Модели в Ollama</div>
        <div class="model-row">
          <select id="modelSelect"></select>
          <button id="useModelBtn" class="ghost">Выбрать модель</button>
          <button id="copyPullBtn" class="ghost">Скопировать команду pull</button>
        </div>
        <div id="modelHint" class="hint"></div>
      </div>
    </section>

    <section class="card">
      <h2>Поведение</h2>
      <div class="grid">
        <label>defaultMode
          <select id="defaultMode">
            <option value="manual">manual</option>
            <option value="autonomous">autonomous</option>
            <option value="survival">survival</option>
          </select>
        </label>
        <label>commandPrefixes (через запятую)<input id="commandPrefixes" type="text" /></label>
        <label>chatCooldown (мс)<input id="chatCooldown" type="number" /></label>
        <label>globalChatCooldown (мс)<input id="globalChatCooldown" type="number" /></label>
        <label>maxChatHistory<input id="maxChatHistory" type="number" /></label>
        <label>socialRoundInterval (мс)<input id="socialRoundInterval" type="number" /></label>
        <label>perPlayerChatCooldown (мс)<input id="perPlayerChatCooldown" type="number" /></label>
        <label>maxFactsPerPlayer<input id="maxFactsPerPlayer" type="number" /></label>
        <label>etiquetteMuteMinutes<input id="etiquetteMuteMinutes" type="number" /></label>
      </div>
    </section>

    <section class="card">
      <h2>Управление ботом</h2>
      <div class="grid">
        <label>Текущий ник<input id="currentUsername" type="text" disabled /></label>
        <label>Новый ник<input id="newUsername" type="text" /></label>
        <label>Текущий режим<input id="currentMode" type="text" disabled /></label>
        <label>Режим
          <select id="liveMode">
            <option value="manual">manual</option>
            <option value="autonomous">autonomous</option>
            <option value="survival">survival</option>
          </select>
        </label>
        <label>Сообщение в чат<input id="liveChat" type="text" /></label>
        <label>Команда боту (LLM)<input id="liveCommand" type="text" /></label>
      </div>
      <div class="actions">
        <button id="applyUsernameBtn" class="ghost">Сменить ник (перезапуск)</button>
        <button id="sendChatBtn" class="primary">Отправить чат</button>
        <button id="sendCommandBtn" class="ghost">Команда LLM</button>
        <button id="setModeBtn" class="ghost">Сменить режим</button>
        <button id="stopTasksBtn" class="ghost">Остановить задачи</button>
        <button id="reloadPromptBtn" class="ghost">Перезагрузить prompt</button>
      </div>
      <div id="botStatusHint" class="hint"></div>
    </section>

    <section class="card">
      <h2>System prompt</h2>
      <textarea id="systemPrompt" rows="14"></textarea>
      <div class="prompt-actions">
        <button id="savePromptBtn" class="primary">Сохранить prompt</button>
        <button id="loadDefaultPromptBtn" class="ghost">Загрузить по умолчанию</button>
      </div>
      <div id="promptSource" class="hint"></div>
    </section>

    <section class="card">
      <h2>Память</h2>
      <div class="grid">
        <label>Автообновление
          <select id="memoryAutoRefresh">
            <option value="true">да</option>
            <option value="false">нет</option>
          </select>
        </label>
        <label>Автосохранение
          <select id="memoryAutoSave">
            <option value="true">да</option>
            <option value="false">нет</option>
          </select>
        </label>
        <label>Игрок (очистить)<input id="memoryPlayerName" type="text" /></label>
        <label>Факт мира<input id="memoryWorldFact" type="text" /></label>
        <label>Событие мира<input id="memoryWorldEvent" type="text" /></label>
      </div>
      <div class="actions">
        <button id="memoryReloadBtn" class="ghost">Загрузить</button>
        <button id="memorySaveBtn" class="primary">Сохранить</button>
        <button id="memoryClearChatBtn" class="ghost">Очистить общий чат</button>
        <button id="memoryClearEventsBtn" class="ghost">Очистить события</button>
        <button id="memoryClearAllBtn" class="ghost">Сбросить всё</button>
        <button id="memoryClearPlayerBtn" class="ghost">Очистить игрока</button>
        <button id="memoryAddFactBtn" class="ghost">Добавить факт</button>
        <button id="memoryAddEventBtn" class="ghost">Добавить событие</button>
      </div>
      <textarea id="memoryText" class="memory-editor" rows="16"></textarea>
      <div id="memoryStatus" class="hint"></div>
    </section>

    <section class="card" data-tab="training">
      <h2>Обучение бота</h2>
      <div class="grid">
        <label>Быстрая команда
          <input id="trainingQuickRule" type="text" placeholder="например: не убегай от крипера" />
        </label>
        <label>Фидбек: описание<input id="trainingRewardNote" type="text" /></label>
        <label>Фидбек: балл<input id="trainingRewardScore" type="number" value="1" /></label>
        <label>Фидбек: правило
          <select id="trainingRewardRuleType">
            <option value="auto">авто</option>
            <option value="must">делай</option>
            <option value="mustNot">нельзя</option>
          </select>
        </label>
      </div>
      <div class="actions">
        <button id="trainingApplyQuickRuleBtn" class="primary">Применить команду</button>
        <button id="trainingRewardAddBtn" class="ghost">Записать фидбек</button>
      </div>
      <div class="grid">
        <label>Правила "делай"
          <textarea id="trainingMust" rows="6"></textarea>
        </label>
        <label>Правила "нельзя"
          <textarea id="trainingMustNot" rows="6"></textarea>
        </label>
      </div>
      <label>Заметки
        <textarea id="trainingNotes" rows="4"></textarea>
      </label>
      <label>Дополнительный промт
        <textarea id="trainingPromptAppend" rows="6"></textarea>
      </label>
      <label>Маршрутизация моделей (JSON)
        <textarea id="trainingModelRouting" rows="6"></textarea>
      </label>
      <label>Поощрения/штрафы (последние)
        <textarea id="trainingRewards" class="log-output" rows="6" readonly></textarea>
      </label>
      <label>Сводка поощрений и приоритетов
        <textarea id="trainingRewardSummary" class="log-output" rows="6" readonly></textarea>
      </label>
      <div class="actions">
        <button id="trainingReloadBtn" class="ghost">Загрузить</button>
        <button id="trainingSaveBtn" class="primary">Сохранить обучение</button>
        <button id="trainingSynthesizeBtn" class="ghost">Синтезировать промт</button>
      </div>
      <label>Синтез промта + памяти
        <textarea id="trainingSynthesis" class="memory-editor" rows="10" readonly></textarea>
      </label>
      <div class="actions">
        <button id="trainingLogReloadBtn" class="ghost">Обновить лог</button>
        <button id="trainingLogClearBtn" class="ghost">Очистить лог</button>
      </div>
      <label>Логи обучения
        <textarea id="trainingLog" class="log-output" rows="8" readonly></textarea>
      </label>
      <h3>Поведенческие переключатели</h3>
      <div class="grid">
        <label>Убегать от крипера
          <select id="trainingFleeCreeper">
            <option value="true">да</option>
            <option value="false">нет</option>
          </select>
        </label>
      </div>
      <div id="trainingStatus" class="hint"></div>
    </section>

    <section class="card">
      <h2>Сохранение</h2>
      <div class="actions">
        <button id="saveConfigBtn" class="primary">Сохранить конфиг</button>
        <span id="saveStatus" class="hint"></span>
      </div>
    </section>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
